<!DOCTYPE html>
<html>
    <head>
        <title>Autonomicpilot - Blog</title>
        <meta name="description=" content="Autonomicpilot is a development blog mainly concerntrating on PHP, MySQL, HTML, dojo js and Zend Framework. "></meta>
        <meta name="google-site-verification" content="mjgCQDZxwMpRvHRHAagtY-XMbybQcepn_5DAYvkQYf8" />
        <link rel="stylesheet" type="text/css" href="/css/reset.css" />
        <link rel="stylesheet" type="text/css" href="/css/site.css" />
        <script type="text/javascript">
            var dsloaded = false;
            var disqus_div = 'disqus_thread';
            function showthatshizzle() {
                var disqus_shortname = 'autonomicpilot';

                if ( dsloaded )
                {
                    return;
                }

                dsloaded = true;

                document.getElementById(disqus_div).style.display = 'block';

                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            }
        </script>
        <script type="text/javascript">

            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-16183577-1']);
            _gaq.push(['_trackPageview']);

        </script>
    </head>
    <body>
        <div id="main_box">
            <div id="header">
                <a href='/'>&nbsp;</a>
                <div>The 8-bit ramblings of a rabid mind</div>
                <br class="clear_both" />
            </div>
            <div id="top_nav">
                <div class="box0n float_left third_width"><a href="/">Home</a></div>
                <div class="box0n float_left third_width"><a href="/betablog/">Blog</a></div>
                <div class="box0n float_left third_width"><a href="/cv.html">CV</a></div>
                <br class="clear_both" />
            </div>
            <div id="content_outer">
                <div id="left" class="float_left">
                    <div class="article_link box0n">
                        <a class="article_link_main" href='/betablog/Posts/SMVsDIAndIoC.html'>&nbsp;</a>
                        <div class="article_link_text">
                            <a href="/betablog/#SMVsDIAndIoC">Inversion of Control: Service Locator Vs Dependency Injection</a><br />
                            14/10/12 12:55:46        <a href="/betablog/Categories/IoC.html">IoC</a><br />
                        </div>
                        <br class="clear_both" />
                        <div class="article_tags">
                                <a href="/betablog/Tags/Service Locator.html">Service Locator</a>        <a href="/betablog/Tags/Service Manager.html">Service Manager</a>        <a href="/betablog/Tags/Dependency Injection.html">Dependency Injection</a>        <a href="/betablog/Tags/invokables.html">invokables</a>        <a href="/betablog/Tags/factories.html">factories</a>        <a href="/betablog/Tags/php.html">php</a>        <a href="/betablog/Tags/zf2.html">zf2</a>        <a href="/betablog/Tags/zendframework2.html">zendframework2</a>
                        </div>
                    </div>                    <div class="article_link box0n">
                        <a class="article_link_main" href='/betablog/Posts/ZSAAndDojoStoreJsonRest.html'>&nbsp;</a>
                        <div class="article_link_text">
                            <a href="/betablog/#ZSAAndDojoStoreJsonRest">ZSAAndDojoStoreJsonRest</a><br />
                            05/10/12 20:38:09        <a href="/betablog/Categories/Uncategorised.html">Uncategorised</a><br />
                        </div>
                        <br class="clear_both" />
                        <div class="article_tags">
                        
                        </div>
                    </div>                    <div class="article_link box0n">
                        <a class="article_link_main" href='/betablog/Posts/ZSAZFUserBjyAuth.html'>&nbsp;</a>
                        <div class="article_link_text">
                            <a href="/betablog/#ZSAZFUserBjyAuth">ZSAZFUserBjyAuth</a><br />
                            10/08/12 22:27:24        <a href="/betablog/Categories/Uncategorised.html">Uncategorised</a><br />
                        </div>
                        <br class="clear_both" />
                        <div class="article_tags">
                        
                        </div>
                    </div>
                </div>
                <div id="main" class="float_left">
                    <div>
                    <div class="article_content box0n" id="SMVsDIAndIoC">
                        <h1 class="article_title"><a href="/betablog/Posts/SMVsDIAndIoC.html">Inversion of Control: Service Locator Vs Dependency Injection</a></h1>
                        <p>Quick notes for dependency injection vs service locator, this is mainly for zf2 but the basics apply elsewhere.</p>

<h1>Inversion of Control</h1>

<p>IoC is a way of getting modules or objects into the right class when they're needed, the instantiation of an object is abstracted away from the class requiring it, in a way that makes duck typing a practical reality.</p>

<h1>Dependency Injection</h1>

<p>Dependency injection relies on reflection to ascertain what objects are required for the construction of a particular object. Configuration is set up so that when the DI container is required to construct a certain object, it knows that it either needs to pass instances of certain other objects to the constructor or to call a 'set' function for that dependency. e.g. obj a requires obj b and obj c, the __construct function signature calls for an object of type b and there is a setC function whos signature calls for an object of type C.
Objects B and C may require further dependencies that can be configured to be injected as well.</p>

<p>This can be considered as an implicit way of injecting dependencies.</p>

<h1>Service Locator</h1>

<p>In a service locator we set a key in the sl to be an instance of an object, if the instance it's self has no dependencies that's the end, however if it does have dependencies then we use a factory or an invokable to pass the sl to an inteligent object that then gets further dependencies from the sl. e.g. obj a relies on obj b and obj c, we pass a factory to the sl as the way of instantiating a, in this factory the sl is passed into it and the factory uses the sl to retrieve instances of obj b and obj c which are used to construct obj a and the new instance of obj a is returned.</p>

<p>This can be considered an explicit way of injecting dependencies.</p>

<h1>DI vs SL</h1>

<p>DI is a bit easier to set up, as it just requires a lot of writing configs, it's also less magical as all the deps for a class are in front of your face in the config files, but it does require a lot of reflection (which may be cacheable) to work out how to get the dep into the class, this can be costly on reources in large classes. 
On the other hand SL uses individual closures or factories to retrieve the deps for instantiating the service requested, and these deps could need further factories for further deps etc requiring a further coder to peice through more and more classes(factories or closures) to understand all the deps being used but you get the service when you need, if in some circumstances you don't need the dep you don't ask for it and you save some resources, with DI you will always have all deps in place, whether you use them or not. 
Also as DI is configured as deps for a class, if multiple places require the same dep you'd have to configure each, whereas with SL you'd just ask for it and it'd already be available without extra configuration.</p>

                    </div>                    <div class="article_content box0n" id="ZSAAndDojoStoreJsonRest">
                        <h1 class="article_title"><a href="/betablog/Posts/ZSAAndDojoStoreJsonRest.html">ZSAAndDojoStoreJsonRest</a></h1>
                        <h1>Zend Framework 2 And Dojo/Store/JsonRest</h1>

<p>We work mainly with dojo at Go MAD Tech and a few of the prototypes I've been working on use json stores, so it seemed an obvious choice to go for using the Dojo/Store/JsonRest implementation for moving the prototypes into the real world. It means I don't have to worry too much about setting up the xhr myself and leave it all to dojo to deal with.</p>

<p>So this entry will cover setting up dojo 1.8 in the Zend Framework 2 skeleton application, setting up a simple RESTful controller and some javascript to test out the dojo store and the zf2 rest controller.</p>

<p>So we setup the zsa as normal using composer
http://autonomicpilot.co.uk/caps/f9e06d.png</p>

<p>As we're just doing this as an example we'll use the dojo CDN
http://autonomicpilot.co.uk/caps/cff75d.png
and configure dojo
http://autonomicpilot.co.uk/caps/8ee8a4.png</p>

<p>We then need to add a new controller that implements the abstract restful controller
http://autonomicpilot.co.uk/caps/d93cf8.png</p>

<p>We'll keep this simple and knock out some fake responses in a bit.</p>

<p>We need to allow access to the controller so we add a new child route to the application config for the rest controller
http://autonomicpilot.co.uk/caps/a76aa4.png</p>

<p>We then need to add the rest controller to our controller's invokables array
http://autonomicpilot.co.uk/caps/884cfa.png</p>

<p>and then add the JsonViewStrategy to the view_manager configuration, this enables the JsonModel to work without phtml files for automatic json encoding and not displaying the layout
http://autonomicpilot.co.uk/caps/c1d87d.png</p>

<p>We then add json handling in our controller
http://autonomicpilot.co.uk/caps/ec91f7.png</p>

<p>And we can test this action with curl from the command line
http://autonomicpilot.co.uk/caps/8c3e4a.png</p>

<p>Add some fake data
http://autonomicpilot.co.uk/caps/94aff6.png
and test from the command line again
http://autonomicpilot.co.uk/caps/0503a6.png</p>

<p>And then put some more dummy responses into our controller</p>

<p>Add a custom not found action to the controller that returns a json error
http://autonomicpilot.co.uk/caps/38facd.png</p>

<p>First a get with an id param
http://autonomicpilot.co.uk/caps/df3f86.png
and test
http://autonomicpilot.co.uk/caps/1b7747.png
and test failure
http://autonomicpilot.co.uk/caps/1b79f2.png</p>

<p>This will be enough for for testing with the Dojo/Store/JsonRest
as our config puts our zsa dojo modules in /js/zsa we create our file there, 
this file could be spread over an mvc setup, but just the one file for now.</p>

<p>We declare our module with a constructor and mix any properties passed into it into itself.
http://autonomicpilot.co.uk/caps/4201a8.png</p>

<p>We then call our functions for setting up the dom, then creating the store and finally for setting up the select dijit.
And then we write those functions ;)</p>

<p>We setup a container node inside the phtml file and then assign that in our js to a member variable.
http://autonomicpilot.co.uk/caps/858067.png
http://autonomicpilot.co.uk/caps/7bcd04.png</p>

<p>Create a Dojo/Store/JsonRest instance and set the url to point to our rest controller.
http://autonomicpilot.co.uk/caps/ce1cb2.png</p>

<p>Then create an nstance of our select and pass it our JsonRest store and place it inside our node.
http://autonomicpilot.co.uk/caps/6bb132.png</p>

<p>We create a launcher file that we use to instantiate our modules further.
http://autonomicpilot.co.uk/caps/d106b9.png
and append it to our head scripts
http://autonomicpilot.co.uk/caps/2c61f6.png</p>

                    </div>                    <div class="article_content box0n" id="ZSAZFUserBjyAuth">
                        <h1 class="article_title"><a href="/betablog/Posts/ZSAZFUserBjyAuth.html">ZSAZFUserBjyAuth</a></h1>
                        <p>After getting zfuser working well with zsa I wanted to try and get something ACL-like working.</p>

<p>The ZFCACL is a bit out of date BjyAuthentication was recommended as a decent alternative.</p>

<p>http://autonomicpilot.co.uk/caps/1c9cbe.png</p>

<p>http://autonomicpilot.co.uk/caps/c11bbc.png
don't strictly need zfc-user as bjyauth installs it, but as this is an extension of the previous I left it in</p>

<p>http://autonomicpilot.co.uk/caps/8758cd.png</p>

<p>http://autonomicpilot.co.uk/caps/5ecceb.png</p>

<p>http://autonomicpilot.co.uk/caps/d8c82e.png</p>

<p>http://autonomicpilot.co.uk/caps/a2fe19.png</p>

<p>install and enable intl php extension</p>

<p>enable modules
http://autonomicpilot.co.uk/caps/aa5361.png</p>

<p>add db config
http://autonomicpilot.co.uk/caps/3e5c0b.png</p>

<p>and we have a working users page
http://autonomicpilot.co.uk/caps/76a23d.png</p>

<p>and working registration
http://autonomicpilot.co.uk/caps/de9e0e.png</p>

<p>Next up we want to get the autorisation working, so we can restrict access to certain areas.
http://autonomicpilot.co.uk/caps/5dcb94.png
The first sections specify providers for how to get current user access etc, we also set up our list of roles, so guest, user with admin extending user, it can also be setup to load roles from the db we set up earlier.
We add a default guard which blocks all access to all controller actions by default :
http://autonomicpilot.co.uk/caps/ec61a4.png
http://autonomicpilot.co.uk/caps/6e0eeb.png as you can see we also restrict access to the users controller, which is no good for registering people, so we modify the guard to allow access to actions in the zfcuser controller
http://autonomicpilot.co.uk/caps/99cc3e.png
this allows all roles to access all actions in the zfcuser controller, if wanted we could restrict so only certain actions are allowed like this
http://autonomicpilot.co.uk/caps/5d71c5.png
thus we gain access to the user controller for login and registering
http://autonomicpilot.co.uk/caps/0bebb3.png</p>

<p>There is a controller plugin but it does pretty much the same as we already do, rather than restricting access inside the controller it's another way of checking if the user is allowed.</p>

                    </div>                    <div class="article_content box0n" id="FactoriesVsInvokables">
                        <h1 class="article_title"><a href="/blog/Posts/FactoriesVsInvokables.html">zendframework2 Tag Page</a></h1>
                        <p>These are just some quick notes really, just for some future reference.</p>

<h1>Invokables</h1>

<p>No deps, can just be instantiated when needed, like controllers normally have no dependencies that are required during construction or required before the object can work properly, even if set via setters.</p>

<h1>Factories</h1>

<p>Dependent on other objects that need fetching before the object will work properly, even if these are set via setters rather than during construction. A factory can be a closure straight in the config (but this stops caching), in the module.php or as concrete classes. These classes are either invokable via __invoke or implement the FactoryInterface.</p>

<p>The concrete class way is best when you're doing some fairly substancial work.
You can either implement the FactoryInterface and then the createService method (which takes a servicelocatorinterface object) or just make the class invokable by implementing __invoke (which also takes the sm in). You can then retrieve other objects from the servicemanager (invokables or factories) and then return an instance of some object, of a singluar type per factory, as a result.</p>

<p>And that's it!</p>

                    </div>
                    </div>
                </div>
                <div id="right" class="float_left">
                    <div class="box0n">
                        <h2>Tags</h2>
                        <br />
        <a href="/betablog/Tags/zf2.html">zf2</a>:4        <a href="/betablog/Tags/composer.html">composer</a>:2        <a href="/betablog/Tags/translation.html">translation</a>:1        <a href="/betablog/Tags/zfc.html">zfc</a>:1        <a href="/betablog/Tags/html.html">html</a>:2        <a href="/betablog/Tags/blog.html">blog</a>:2        <a href="/betablog/Tags/responsive.html">responsive</a>:1        <a href="/betablog/Tags/php.html">php</a>:3        <a href="/betablog/Tags/noframework.html">noframework</a>:1        <a href="/betablog/Tags/invokables.html">invokables</a>:2        <a href="/betablog/Tags/factories.html">factories</a>:2        <a href="/betablog/Tags/zendframework2.html">zendframework2</a>:2        <a href="/betablog/Tags/Service Locator.html">Service Locator</a>:1        <a href="/betablog/Tags/Service Manager.html">Service Manager</a>:1        <a href="/betablog/Tags/Dependency Injection.html">Dependency Injection</a>:1
                    </div>
                    <div class="box0n">
                        <h2>Categories</h2>
                        <br />
        <a href="/betablog/Categories/ZF2.html">ZF2</a><br />        <a href="/betablog/Categories/readme.html">readme</a><br />        <a href="/betablog/Categories/blog.html">blog</a><br />        <a href="/betablog/Categories/Uncategorised.html">Uncategorised</a><br />        <a href="/betablog/Categories/IoC.html">IoC</a><br />
                    </div>
                </div>
                <br class="clear_both" />
            </div>
        </div>
        <script type="text/javascript" src="/js/ga.js"></script>
    </body>
</html>